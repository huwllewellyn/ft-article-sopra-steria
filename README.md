# FT Article - React + Vite

A Financial Times partner content article built with React and Vite, designed for deployment on both GitHub Pages and S3.

## Overview

This project uses the FT's partner content HTML template as the base shell, with React components injected into specific mount points. The build is configured for relative path asset loading, making it compatible with both GitHub Pages and S3 bucket deployments.

### Key Features

- **Vite**: Fast build tool with HMR (Hot Module Replacement) for development
- **React 19**: Modern UI component framework
- **Styled Components**: CSS-in-JS styling solution
- **Framer Motion**: Animation library with scroll tracking
- **Lottie React**: Vector animation support
- **LottieScrolljack**: Full-width, sticky scroll-driven Lottie animations
- **Responsive Breakpoints**: Mobile, tablet, and desktop optimizations
- **Relative Path Build**: Works on both GitHub Pages and S3 without path changes

## Project Structure

```
ft-article-sopra-steria/
├── src/
│   ├── App.jsx              # Main app component containing all sections
│   ├── main.jsx             # React entry point (mounts App to DOM)
│   ├── index.css            # Global styles
│   ├── components/
│   │   ├── LottieScrolljack.jsx           # Reusable full-width scroll-driven animation
│   │   ├── LottieAnimation.jsx            # Base Lottie animation component
│   │   ├── ResponsiveLottieAnimation.jsx  # Responsive breakpoint wrapper
│   │   ├── RisksSection.jsx               # Chapter 0 - Risk overview
│   │   ├── PolycrisisSection.jsx          # Chapter 1 - Polycrisis
│   │   ├── NexusInActionSection.jsx       # Chapter 2 - Nexus in action
│   │   ├── RiskPerceptionsSection.jsx     # Chapter 3 - Risk perceptions
│   │   ├── PreparingForComplexitySection.jsx  # Chapter 4 - Preparing for complexity
│   │   └── shared/                        # Reusable components
│   │       ├── SectionTitleGroup.jsx
│   │       ├── Quote.jsx
│   │       └── ChapterNumber.jsx
│   └── utils/
│       ├── breakpoints.js    # Responsive breakpoint definitions
│       └── assetPath.js      # Asset path utility for relative loading
├── dist/
│   └── lottie/              # Lottie animation JSON files
│       ├── mobile/
│       ├── tablet/
│       └── desktop/
├── index.html               # FT template shell with React mount point
├── vite.config.js           # Vite configuration (includes base: './')
├── package.json             # Dependencies and scripts
└── dist/                    # Built output (generated by `npm run build`)
```

## Installation

1. **Clone and install dependencies:**
   ```bash
   npm install
   ```

2. **Install key libraries** (already included):
   ```bash
   npm install styled-components lottie-react framer-motion
   ```

## Development

Start the local development server with hot module replacement:

```bash
npm run dev
```

The app will be available at `http://localhost:5173/`

## Building

Build the project for production:

```bash
npm run build
```

This creates a `dist` folder with:
- `index.html` - The complete HTML file with inlined React code
- `assets/` - JavaScript and CSS bundles

## Image Optimization

Images in `public/images/` can be compressed and resized using the provided script. This significantly reduces file sizes while maintaining high quality.

### Running Image Compression

```bash
./compress-images.sh
```

**What it does:**
- Scales images to height of 590px (maintaining aspect ratio)
- Crops excess width from left and right to achieve 354x590px portrait dimensions
- Compresses images to high quality using ffmpeg
- Backs up original images to `public/images-src/`
- Replaces originals with compressed versions

**Example results:**
- 19MB → 148KB (128x smaller)
- 10MB → 24KB (417x smaller)
- Most files: 5-15MB → 32-72KB (100-300x smaller)

**Configuration:** Edit the WIDTH, HEIGHT, and other settings at the top of `compress-images.sh` to adjust target dimensions or compression quality.

### Video Compression

Videos in `public/images/` can be compressed and resized using a similar script. This scales landscape videos to portrait dimensions (354x590px) by scaling and cropping.

```bash
./compress-videos.sh
```

**What it does:**
- Scales videos to height of 590px (maintaining aspect ratio)
- Crops excess width from left and right to achieve 354x590px portrait dimensions
- Re-encodes with H.264 codec for web delivery
- Backs up original videos to `public/images-src/`
- Replaces originals with compressed versions

**Example results:**
- 1.0MB → 376KB (2.7x smaller)
- 13MB → 2.8MB (4.6x smaller)

**Configuration:** Edit WIDTH, HEIGHT, and CRF (quality) settings at the top of `compress-videos.sh`:
- `CRF`: 0-51 (lower = better quality; 18-28 is good quality range; 23 is default)
- `preset`: ultrafast to veryslow (affects encoding speed and final size)

## Deployment

### GitHub Pages (for Preview/Review)

This repository is configured for GitHub Pages deployment.

**Deploy updates:**
```bash
npm run deploy
```

This will:
1. Build the project (`npm run build`)
2. Deploy the dist folder to the `gh-pages` branch
3. GitHub Pages serves changes at: `https://casper-codes.github.io/ft-article-sopra-steria`

**Sharing with stakeholders:**
Send the GitHub Pages link for design review before final S3 deployment.

### S3 (for Final Deployment)

The built `dist` folder is ready for S3 deployment:

1. **Build the project:**
   ```bash
   npm run build
   ```

2. **Upload to S3:**
   - Compress the `dist` folder contents
   - Send to FT S3 team or upload via S3 console
   - The relative paths (`./`) will work correctly in any S3 folder structure

**No additional configuration needed** — the `base: './'` in vite.config.js handles relative path loading for both GitHub Pages and S3.

## Lottie Scrolljack

### Overview

The `LottieScrolljack` component creates a full-width, sticky animation that scrubs through based on scroll position. As users scroll through a designated track area, the animation stays sticky in the viewport while its frames advance based on scroll progress.

### Features

- **Full viewport width** - Animations stretch to 100% width
- **Responsive height** - Height automatically scales based on animation aspect ratio
- **Viewport height constraint** - Never exceeds 100svh (small viewport height units)
- **Smart width adjustment** - If aspect ratio would exceed viewport height, width is reduced proportionally
- **Centered display** - Animation centered with background color filling empty space
- **Automatic aspect ratio detection** - Fetches animation JSON to calculate optimal dimensions
- **Customizable track height** - Control scroll distance (default: 4000px)

### Usage

```jsx
import LottieScrolljack from './LottieScrolljack'

export default function MySection() {
  return (
    <LottieScrolljack
      animations={{
        mobile: "/lottie/mobile/animation.json",
        tablet: "/lottie/tablet/animation.json",
        desktop: "/lottie/desktop/animation.json",
      }}
      backgroundColor="#FFFFFF"
      loop={false}
      trackHeight="2000px"  // Optional - default 4000px
    />
  )
}
```

### Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `animations` | Object | Required | Breakpoint-mapped animation paths |
| `backgroundColor` | String | `#FFFFFF` | Background color for viewport |
| `trackHeight` | String | `4000px` | Scrollable track area height |
| `loop` | Boolean | `false` | Whether animation loops |
| `autoplay` | Boolean | `false` | Whether animation plays automatically |

### How It Works

1. **User scrolls** through the AnimationTrack container (1000px+ tall)
2. **Scroll progress** (0-1) is tracked via framer-motion's `useScroll` hook
3. **Animation frame** is calculated: `progress × totalFrames`
4. **Lottie instance** receives frame updates via `goToAndStop()`
5. **No re-renders** on frame changes (performance optimized)

## Component Structure

### Core Animation Components

#### LottieScrolljack
Reusable component for full-width, scroll-driven animations. Handles:
- Aspect ratio detection
- Viewport height constraints
- Scroll progress tracking
- Frame synchronization

#### LottieAnimation
Base animation component that wraps lottie-web. Features:
- Lazy loading via Intersection Observer
- Scroll progress support (via framer-motion MotionValue)
- Fallback path support
- SVG/canvas renderer options

#### ResponsiveLottieAnimation
Breakpoint-aware wrapper that:
- Detects current screen size
- Selects appropriate animation file
- Passes through animation props
- Handles window resize events

### Section Components

Each chapter uses the `LottieScrolljack` component for full-width animations:
- **RisksSection** - DP01 animation
- **PolycrisisSection** - DP02 animation
- **NexusInActionSection** - DP03 & DP04 animations
- **RiskPerceptionsSection** - DP05 & DP06 animations
- **PreparingForComplexitySection** - DP07 animation
- **VizSection** - DP01 animation

### Creating New Sections

When adding new sections with scrolljack animations, follow this pattern:

```jsx
// src/components/NewSection.jsx
import styled from 'styled-components'
import { motion } from 'framer-motion'
import LottieScrolljack from './LottieScrolljack'

const Container = styled.section`
  width: 100%;
  max-width: 1440px;
  margin: 0 auto;
  padding: 80px 40px;
  background: #FFFFFF;
`

const ContentWrapper = styled.div`
  max-width: 900px;
  margin: 0 auto;
`

const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: { staggerChildren: 0.2, delayChildren: 0.1 }
  }
}

const itemVariants = {
  hidden: { opacity: 0, y: 20 },
  visible: { opacity: 1, y: 0, transition: { duration: 0.6 } }
}

export default function NewSection() {
  return (
    <>
      <Container>
        <ContentWrapper>
          <motion.div
            initial="hidden"
            whileInView="visible"
            viewport={{ once: true, margin: '-100px' }}
            variants={containerVariants}
          >
            {/* Your text content */}
          </motion.div>
        </ContentWrapper>
      </Container>

      {/* Add scrolljack animation */}
      <LottieScrolljack
        animations={{
          mobile: '/lottie/mobile/animation.json',
          tablet: '/lottie/tablet/animation.json',
          desktop: '/lottie/desktop/animation.json'
        }}
        backgroundColor="#FFFFFF"
        loop={false}
      />
    </>
  )
}
```

Then import and add to App.jsx:
```jsx
import NewSection from './components/NewSection'

function App() {
  return (
    <>
      <NewSection />
    </>
  )
}
```

## Dependencies

### Runtime
- **react**: ^19.2.0 — UI framework
- **react-dom**: ^19.2.0 — DOM rendering
- **styled-components**: ^6.1.19 — CSS-in-JS styling
- **framer-motion**: ^12.23.24 — Animation library
- **lottie-react**: ^2.4.1 — Vector animations

### Development
- **vite**: ^7.2.4 — Build tool
- **@vitejs/plugin-react**: ^5.1.1 — Vite React plugin
- **eslint**: ^9.39.1 — Code linting
- **gh-pages**: ^6.3.0 — GitHub Pages deployment

## Styling Notes

- **FT CSS**: External FT stylesheets are loaded in index.html
- **React Styles**: Use styled-components for component-level styling
- **Global Styles**: Minimal reset in `src/index.css` to avoid conflicts with FT styling

The FT template handles:
- Header and footer styling
- Layout structure (vertical flow in `.pc-content`)
- Brand colors and typography

## Environment

- **Node.js**: 18+ recommended
- **Package Manager**: npm

## Git Workflow

1. **Develop locally:**
   ```bash
   npm run dev
   ```

2. **Commit changes:**
   ```bash
   git add .
   git commit -m "Description of changes"
   git push
   ```

3. **Deploy to GitHub Pages:**
   ```bash
   npm run deploy
   ```

4. **Final S3 Handoff:**
   - Build the project
   - Zip the `dist` folder
   - Send to FT S3 team with deployment instructions

## Troubleshooting

**Problem:** Assets not loading on GitHub Pages
- **Solution:** Ensure `base: './'` is set in vite.config.js

**Problem:** Styling broken after build
- **Solution:** Check that FT CSS is being loaded from index.html (not stripped during build)

**Problem:** React component not rendering
- **Solution:** Verify the React mount point `<div id="react-root"></div>` exists in index.html

**Problem:** LottieScrolljack animation not scrubbing
- **Solution:**
  - Verify animation track height is tall enough (minimum 1000px recommended)
  - Check that Lottie JSON files are loading (check Network tab in DevTools)
  - Ensure `loop={false}` and `autoplay={false}` for scrolljack behavior

**Problem:** Animation exceeds viewport height on mobile
- **Solution:** This is expected behavior - width automatically reduces to fit within 100svh. Verify aspect ratio calculation is correct.

**Problem:** Scroll tracking not working
- **Solution:**
  - Check that framer-motion is properly installed
  - Verify `target` ref is properly attached to AnimationTrack
  - Ensure offset values in `useScroll` are correct: `["start start", "end end"]`

**Problem:** Lottie animation frames jumping/stuttering
- **Solution:**
  - Frame count may be too high - reduce animation complexity or split into smaller animations
  - Enable scroll debouncing for very large frame counts
  - Use SVG renderer (default) rather than canvas for better performance

## Future Enhancements

Consider adding:
- TypeScript support
- E2E testing (Playwright/Cypress)
- Component library/Storybook
- Design tokens/theme management
- Accessibility auditing

## Resources

### Documentation
- [Vite Documentation](https://vitejs.dev)
- [React Documentation](https://react.dev)
- [Styled Components Documentation](https://styled-components.com)
- [Framer Motion Guide](https://www.framer.com/motion/)
- [Lottie Web Documentation](https://airbnb.io/lottie/web.html)
- [Lottie React Documentation](https://github.com/LottieFiles/lottie-react)

### Animation & Scrolling
- [Framer Motion Scroll Documentation](https://www.framer.com/motion/use-scroll/)
- [Lottie Animation Library](https://lottiefiles.com)

### Design & Standards
- [FT Origami Components](https://origami.ft.com)
- [Responsive Design Breakpoints](https://www.figma.com/design/) (for Figma integration via MCP)

## License

Proprietary - Financial Times Partner Content
